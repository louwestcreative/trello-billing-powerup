document.getElementById('testBtn').addEventListener('click', async () => {
  const apiKey = document.getElementById('apiKeyInput').value.trim();
  if (!apiKey) {
    updateStatus('API key cannot be empty for test.', true);
    return;
  }
  try {
    const response = await fetch('http://localhost:3000/validate-toggl-key', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ apiKey }),
    });

    if (response.ok) {
      const result = await response.json();
      if (result.valid) {
        updateStatus('API key is valid!');
      } else {
        updateStatus('API key is invalid: ' + (result.error || 'Unknown error'), true);
      }
    } else {
      const error = await response.json();
      updateStatus('Error: ' + (error.error || 'Unknown error'), true);
    }
  } catch (error) {
    updateStatus('Test failed: ' + error.message, true);
  }
});
